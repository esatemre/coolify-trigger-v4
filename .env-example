# =============================================================================
# Trigger.dev for Coolify v4 - Environment Variables
# =============================================================================
# NOTE: Coolify auto-generates SERVICE_* variables (passwords, URLs, FQDNs)
#       Only customize the variables below as needed
# =============================================================================

# -----------------------------------------------------------------------------
# Image Versions (recommended to lock for production)
# -----------------------------------------------------------------------------
TRIGGER_IMAGE_TAG=v4-beta
POSTGRES_IMAGE_TAG=14
REDIS_IMAGE_TAG=7
ELECTRIC_IMAGE_TAG=1.0.24
CLICKHOUSE_IMAGE_TAG=latest
MINIO_IMAGE_TAG=latest
DOCKER_PROXY_IMAGE_TAG=latest

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
POSTGRES_DB=trigger
CLICKHOUSE_ADMIN_USER=default

# -----------------------------------------------------------------------------
# Docker Runner Configuration
# -----------------------------------------------------------------------------
# IMPORTANT: Update this after first deployment with your actual network name
# Find it in Coolify (will be something like project-xxx-net)
DOCKER_RUNNER_NETWORKS=trigger-net

# -----------------------------------------------------------------------------
# Node.js Configuration
# -----------------------------------------------------------------------------
# Memory limit in MiB - adjust based on your machine size (default: 1024)
# Examples: 1024 (1GB), 2048 (2GB), 4096 (4GB), 8192 (8GB)
NODE_MAX_OLD_SPACE_SIZE=1024

# -----------------------------------------------------------------------------
# Container Registry Configuration (for deployments)
# -----------------------------------------------------------------------------
# Use GitHub Container Registry (recommended) or Docker Hub
DEPLOY_REGISTRY_HOST=ghcr.io
# Your GitHub username or organization (e.g., "myuser" for ghcr.io/myuser/...)
DEPLOY_REGISTRY_NAMESPACE=
# GitHub Personal Access Token with packages:write scope
DEPLOY_REGISTRY_USERNAME=
DEPLOY_REGISTRY_PASSWORD=

# -----------------------------------------------------------------------------
# Email Configuration (Optional - for production magic link delivery)
# -----------------------------------------------------------------------------
# Leave empty to log magic links to console only (development)
# For production, set EMAIL_TRANSPORT to 'resend', 'smtp', or 'aws-ses'

EMAIL_TRANSPORT=
FROM_EMAIL=
REPLY_TO_EMAIL=

# Resend (if EMAIL_TRANSPORT=resend)
RESEND_API_KEY=

# SMTP (if EMAIL_TRANSPORT=smtp)
SMTP_HOST=
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASSWORD=

# AWS SES (if EMAIL_TRANSPORT=aws-ses)
AWS_REGION=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# -----------------------------------------------------------------------------
# Authentication & Access Control (Optional)
# -----------------------------------------------------------------------------
# GitHub OAuth (requires GitHub OAuth app setup)
AUTH_GITHUB_CLIENT_ID=
AUTH_GITHUB_CLIENT_SECRET=

# Email whitelist (regex pattern, applies to all auth methods)
# Example: "user1@domain\.com|user2@domain\.com"
WHITELISTED_EMAILS=

# Admin auto-promotion (regex pattern of emails to auto-promote to admin)
# Example: "admin@company\.com"
ADMIN_EMAILS=

# -----------------------------------------------------------------------------
# Concurrency & Performance
# -----------------------------------------------------------------------------
# Max concurrent task executions per environment (default: 100)
DEFAULT_ENV_EXECUTION_CONCURRENCY_LIMIT=100
# Max concurrent task executions per organization (default: 300, should be 3x env limit)
DEFAULT_ORG_EXECUTION_CONCURRENCY_LIMIT=300
# Max concurrent dev runs via CLI (default: 25)
DEV_MAX_CONCURRENT_RUNS=25

# Internal worker settings
WORKER_CONCURRENCY=10
WORKER_POLL_INTERVAL=1000

# -----------------------------------------------------------------------------
# Payload & Metadata Limits
# -----------------------------------------------------------------------------
# Task payload offload threshold in bytes (default: 524288 = 512KB)
TASK_PAYLOAD_OFFLOAD_THRESHOLD=524288
# Max task payload size in bytes (default: 3145728 = 3MB)
TASK_PAYLOAD_MAXIMUM_SIZE=3145728
# Max batch payload size in bytes (default: 1000000 = 1MB)
BATCH_TASK_PAYLOAD_MAXIMUM_SIZE=1000000
# Max task metadata size in bytes (default: 262144 = 256KB)
TASK_RUN_METADATA_MAXIMUM_SIZE=262144

# -----------------------------------------------------------------------------
# Realtime Settings
# -----------------------------------------------------------------------------
# Max length of realtime stream (default: 1000)
REALTIME_STREAM_MAX_LENGTH=1000
# Realtime stream TTL in seconds (default: 86400 = 1 day)
REALTIME_STREAM_TTL=86400

# -----------------------------------------------------------------------------
# Supervisor Configuration (Advanced)
# -----------------------------------------------------------------------------
# Enable debug logging in supervisor (default: false, set to 1 to enable)
SUPERVISOR_DEBUG=0
# Enforce machine preset CPU/memory limits (default: true)
DOCKER_ENFORCE_MACHINE_PRESETS=1
# Auto-remove exited containers (default: true)
DOCKER_AUTOREMOVE_EXITED_CONTAINERS=1
# Dequeue interval in milliseconds (default: 250)
TRIGGER_DEQUEUE_INTERVAL_MS=250
# Dequeue idle interval in milliseconds (default: 1000)
TRIGGER_DEQUEUE_IDLE_INTERVAL_MS=1000
# Pretty logs for runner (default: false)
RUNNER_PRETTY_LOGS=false
# Additional environment variables for runners (CSV format)
RUNNER_ADDITIONAL_ENV_VARS=

# -----------------------------------------------------------------------------
# Telemetry & Monitoring
# -----------------------------------------------------------------------------
TRIGGER_TELEMETRY_DISABLED=1
INTERNAL_OTEL_TRACE_LOGGING_ENABLED=0
